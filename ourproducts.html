<!DOCTYPE html>
<html>
<head>
  <title>Product List</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.20/lodash.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/3.5.5/jspdf.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js"></script>
</head>
<body>
  <input type="text" id="search">
  <button id="clear-search">Show All</button>
  <h1>Categories</h1>
  <div id="categories"></div>
  <script id="category-template" type="text/x-handlebars-template">
    {{#each categories}}
      <div class="category">
        <h2 class="category-title">{{this.title}}</h2>
        <div class="category-products">
          {{#each this.products}}
            <div class="product-item">
              <input type="checkbox" class="product-checkbox" {{#if this.checked}}checked{{/if}}>
              <span class="product-title">{{this.title}}</span>
              <label>
                Quantity:
                <input type="number" class="product-quantity">
              </label>
              <label>
                Unit:
                <input type="text" class="product-unit">
              </label>
            </div>
          {{/each}}
        </div>
      </div>
    {{/each}}
  </script>
  
<button id="save-pdf">Save as PDF</button>


  <script>
    const data = {
      categories: [
        {
          title: 'Category 1',
          products: [
            { title: 'Product 1', checked: false },
            { title: 'Product 2', checked: false }
          ]
        },
        {
          title: 'Category 2',
          products: [
            { title: 'Product 3', checked: false },
            { title: 'Product 4', checked: false }
          ]
        }
      ]
    };

    const $categories = $('#categories');
    const $search = $('#search');
    const $clearSearch = $('#clear-search');
    const source = $('#category-template').html();
    const template = Handlebars.compile(source);

    function renderCategories(categories) {
      $categories.html(template({ categories }));
    }

    
$search.on('input', () => {
  const searchQuery = $search.val().toLowerCase();
  let categories = data.categories;

  if (searchQuery.trim() !== '') {
    categories = categories.map((category) => {
      const products = category.products.filter((product) => {
        return product.title.toLowerCase().includes(searchQuery);
      });
      return { ...category, products };
    });
  }

  renderCategories(categories);
});
    
    $clearSearch.on('click', () => {
      $search.val('');
      $search.trigger('input');
    });

    $categories.on('change', '.product-checkbox', (event) => {
      const $checkbox = $(event.target);
      const $productItem = $checkbox.closest('.product-item');
      const $category = $productItem.closest('.category');
      const productIndex = $productItem.index();
      const categoryIndex = $category.index();

      data.categories[categoryIndex].products[productIndex].checked = $checkbox.prop('checked');
    });

    renderCategories(data.categories);
  </script>
  

  <script>
  $('#save-pdf').on('click', () => {
  // Create a new PDF document
  const doc = new jsPDF();

  // Get the selected products
  const selectedProducts = data.categories
    .map((category) => {
      return category.products.filter((product) => product.checked);
    })
    .reduce((acc, products) => acc.concat(products), []);

  // Add the selected products to the PDF
  doc.text('Selected Products:', 10, 10);
  selectedProducts.forEach((product, index) => {
    doc.text(`${index + 1}. ${product.title}`, 10, 15 + (index * 5));
  });

  // Save the PDF
  doc.save('selected-products.pdf');
});
</script>

</body>
</html>
