<!DOCTYPE html>
<html>
<head>
  <title>Product List</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.20/lodash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js"></script>
</head>
<body>
  <input type="text" id="search">
  <button id="clear-search">Show All</button>
  <h1>Categories</h1>
  <div id="categories"></div>
  <script id="category-template" type="text/x-handlebars-template">
    {{#each categories}}
      <div class="category">
        <h2 class="category-title">{{this.title}}</h2>
        <div class="category-products">
          {{#each this.products}}
            <div class="product-item">
              <input type="checkbox" class="product-checkbox" {{#if this.checked}}checked{{/if}}>
              <span class="product-title">{{this.title}}</span>
              <label>
                Quantity:
                <input type="number" class="product-quantity">
              </label>
              <label>
                Unit:
                <input type="text" class="product-unit">
              </label>
            </div>
          {{/each}}
        </div>
      </div>
    {{/each}}
  </script>
  
<button id="save-pdf">Save as PDF</button>


  <script>
    const data = {
      categories: [
        {
          title: 'Category 1',
          products: [
            { title: 'Product 1', checked: false },
            { title: 'Product 2', checked: false }
          ]
        },
        {
          title: 'Category 2',
          products: [
            { title: 'Product 3', checked: false },
            { title: 'Product 4', checked: false }
          ]
        }
      ]
    };

    const $categories = $('#categories');
    const $search = $('#search');
    const $clearSearch = $('#clear-search');
    const source = $('#category-template').html();
    const template = Handlebars.compile(source);

    function renderCategories(categories) {
      $categories.html(template({ categories }));
    }

    $search.on('input', () => {
      const searchQuery = $search.val().toLowerCase();
      let categories = data.categories;

      if (searchQuery.trim() !== '') {
        categories = categories.map((category) => {
          const products = category.products.filter((product) => {
            return product.title.toLowerCase().includes(searchQuery);
          });
          return { ...category, products };
        });
      }

      renderCategories(categories);
   
});

    $clearSearch.on('click', () => {
      $search.val('');
      $search.trigger('input');
    });

    $categories.on('change', '.product-checkbox', (event) => {
      const $checkbox = $(event.target);
      const $productItem = $checkbox.closest('.product-item');
      const $category = $productItem.closest('.category');
      const productIndex = $productItem.index();
      const categoryIndex = $category.index();

      data.categories[categoryIndex].products[productIndex].checked = $checkbox.prop('checked');
    });

    renderCategories(data.categories);
  </script>
  
<script>
  function downloadPdf() {
    const doc = new jsPDF();
    const selectedProducts = data.categories
      .map((category) => category.products)
      .flat()
      .filter((product) => product.checked);

    if (selectedProducts.length === 0) {
      alert('No products selected');
      return;
    }

    doc.text('Selected Products', 10, 10);
    doc.line(10, 11, 200, 11);

    let y = 20;
    selectedProducts.forEach((product) => {
      doc.text(product.title, 10, y);
      doc.text(product.quantity, 60, y);
      doc.text(product.unit, 100, y);
      y += 10;
    });

    doc.save('selected-products.pdf');
  }
</script>
<script>
const $savePdf = $('#save-pdf');

$savePdf.on('click', () => {
  downloadPdf();
});
  </script>
</body>
</html>
